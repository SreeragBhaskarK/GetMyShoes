<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Cookie&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&display=swap"
    rel="stylesheet">
<link rel="stylesheet" href="/users/product_details/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="/users/product_details/css/elegant-icons.css" type="text/css">
<link rel="stylesheet" href="/users/product_details/css/jquery-ui.min.css" type="text/css">
<link rel="stylesheet" href="/users/product_details/css/magnific-popup.css" type="text/css">
<link rel="stylesheet" href="/users/product_details/css/owl.carousel.min.css" type="text/css">
<link rel="stylesheet" href="/users/product_details/css/slicknav.min.css" type="text/css">
<link rel="stylesheet" href="/users/product_details/css/style.css" type="text/css">
<!-- Shop Section Begin -->
<section class="shop spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-3 col-md-3">
                <div class="shop__sidebar">
                    <div class="sidebar__categories">
                        <div class="section-title">
                            <h4>Categories</h4>
                        </div>
                        <div class="categories__accordion">
                            <div class="accordion" id="accordionExample">
                                <div class="card">
                                    <div class="card-heading active">
                                        <a data-toggle="collapse" data-target="#collapseOne">All</a>
                                    </div>
                                    <div id="collapseOne" class="collapse show" data-parent="#accordionExample">
                                        <div class="card-body">
                                            <ul>
                                                <% parentCateagory.forEach(i=> { %>

                                                    <li><a onclick="test('<%=i.category  %>')">
                                                            <%=i.category%>
                                                        </a></li>
                                                    <% }) %>

                                            </ul>
                                        </div>
                                    </div>
                                </div>


                            </div>
                        </div>
                    </div>
                    <div class="sidebar__filter">
                        <div class="section-title">
                            <h4>Shop by price</h4>
                        </div>
                        <div class="filter-range-wrap">
                            <div id="price-range"
                                class="price-range ui-slider ui-corner-all ui-slider-horizontal ui-widget ui-widget-content"
                                data-min="100" data-max="50000"></div>
                            <div class="range-slider">
                                <div class="price-input" style="display: flex;">
                                    <p class="me-2">Price:</p>
                                    <input class="me-3" style="width: 100%; max-width:none" type="text" id="minamount">
                                    <input style="width: 100%; max-width:none" type="text" id="maxamount">

                                </div>
                            </div>
                        </div>
                        <!--  <a href="#">Filter</a> -->
                    </div>
                    <% if (brandCateagory[0]) { %>


                        <div class="sidebar__sizes">
                            <div class="section-title">
                                <h4>Shop by BRAND</h4>
                            </div>
                            <div class="size__list">
                                <% brandCateagory.forEach(i=> { %>
                                    <label for="<%= i.category%>">
                                        <%= i.category%>
                                            <input type="radio" name="brand" onclick="test('<%=i.category%>')"
                                                id="<%=i.category%>" value="<%=i._id%>" class="category-checkbox">
                                            <span class="checkmark"></span>
                                    </label>
                                    <% }) %>

                            </div>
                        </div>
                        <% } %>
                            <% if (subCateagory[0]) { %>


                                <div class="sidebar__sizes">
                                    <div class="section-title">
                                        <h4>Shop by Other</h4>
                                    </div>
                                    <div class="size__list">
                                        <% subCateagory.forEach(i=> { %>
                                            <label for="<%= i.category%>">
                                                <%= i.category%>
                                                    <input type="radio" name="brand" onclick="test('<%=i.category%>')"
                                                        id="<%=i.category%>" value="<%=i._id%>"
                                                        class="category-checkbox">
                                                    <span class="checkmark"></span>
                                            </label>
                                            <% }) %>

                                    </div>
                                </div>
                                <% } %>
                </div>
            </div>
            <div class="col-lg-9 col-md-9">
                <div class="row" id="product-list">
                    <% (locals.productData || [] ).forEach(product=> { %>
                        <div class="col-lg-4 col-md-6">


                            <li class="product-item">
                                <div class="product-card" tabindex="0">

                                    <figure class="card-banner">
                                        <a href="/product/<%=product._id%>"><img
                                                src="/images/products_image/<%=product.product_image[0]%>" width="312"
                                                height="350" loading="lazy" alt="Running Sneaker Shoes"
                                                class="image-contain"></a>

                                        <% if (product.product_badge) { %>

                                            <div class="card-badge">
                                                <%=product.product_badge%>
                                            </div>
                                            <% } %>
                                                <ul class="card-action-list">

                                                    <li class="card-action-item">
                                                        <button <% if (locals.userActive) { %>
                                                            onclick="cartCount('<%=product._id%>','<%=product.product_stock%>')"
                                                                <% }else{ %>
                                                                    onclick="goToLoginPage()"
                                                                    <% } %>
                                                                        class="card-action-btn"
                                                                        aria-labelledby="card-label-1">
                                                                        <ion-icon name="cart-outline"></ion-icon>
                                                        </button>

                                                        <div class="card-action-tooltip" id="card-label-1">Add to Cart
                                                        </div>
                                                    </li>

                                                    <li class="card-action-item">
                                                        <button <% if (locals.userActive) { %>
                                                            onclick="addToWishlist('<%=product._id%>')"
                                                                <% }else{ %>
                                                                    onclick="goToLoginPage()"
                                                                    <% } %> class="card-action-btn"

                                                                        aria-labelledby="card-label-2">
                                                                        <ion-icon name="heart-outline"></ion-icon>
                                                        </button>

                                                        <div class="card-action-tooltip" id="card-label-2">Add to
                                                            Whishlist
                                                        </div>
                                                    </li>



                                                </ul>
                                    </figure>

                                    <div class="card-content">

                                        <div class="card-cat">
                                            <% (product.product_categoryName || []).forEach(i=> { %>


                                                <a href="/<%= i.category %>" class="card-cat-link">
                                                    <%= i.category %>

                                                </a>
                                                <% }) %>
                                                    <!--   <a href="#" class="card-cat-link">Men</a> /
                                        <a href="#" class="card-cat-link">Women</a> -->
                                        </div>

                                        <h3 class="h3 card-title">
                                            <!--  <a href="#">Running Sneaker Shoes</a> -->
                                            <a href="/product/<%=product._id%>">
                                                <%= product.product_name %>
                                            </a>
                                        </h3>
                                        <% if (product.product_stock>0) { %>

                                            <data class="card-price" value="14799">₹<%=product.product_price %><del>
                                                        <%=product.product_old_price %>
                                                    </del></data>
                                            <% }else{ %>
                                                <span class="text-danger">
                                                    Out Of Stock
                                                </span>

                                                <% } %>




                                    </div>

                                </div>
                            </li>


                        </div>
                        <% }) %>



                            <div class="col-lg-12 text-center mt-5 ">
                                <div class="pagination__option">
                                    <a class="page-link" href="/shop">1</a>
                                    <% for (let i=2 ; i<=totalPages;i++) { %>
                                        <a class="page-link" href="/shop?page=<%= i %>">
                                            <%= i %>
                                        </a>
                                        <% } %>
                                            <!--   <a href="#"><i class="fa fa-angle-right"></i></a> -->
                                </div>
                            </div>
                </div>
            </div>
        </div>
    </div>
</section>
<script>
    // Get the first page link and add the "active" class
    /*     const paginationContainer = document.getElementById('pagination-container');
        const pageLinks = paginationContainer.querySelectorAll('.page-link');
    
        pageLinks.forEach((pageLink) => {
            pageLink.addEventListener('click', (event) => {
                // Prevent the link from reloading the page
                event.preventDefault();
    
                // Remove the "active" class from the previously active page link
                const previouslyActivePageLink = paginationContainer.querySelector('.page-link.active');
                if (previouslyActivePageLink) {
                    previouslyActivePageLink.classList.remove('active');
                }
    
                // Add the "active" class to the clicked page link
                pageLink.classList.add('active');
    
                // TODO: Update the page content based on the clicked page number
            });
        }); */
</script>
<!-- Shop Section End -->
<!-- Js Plugins -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<!-- <script src="/users/js/jquery-3.3.1.min.js"></script> -->
<script src="/users/js/bootstrap.min.js"></script>
<script src="/users/js/jquery.magnific-popup.min.js"></script>
<script src="/users/js/jquery-ui.min.js"></script>
<script src="/users/js/mixitup.min.js"></script>
<script src="/users/js/jquery.countdown.min.js"></script>
<script src="/users/js/jquery.slicknav.js"></script>
<script src="/users/js/owl.carousel.min.js"></script>
<script src="/users/js/jquery.nicescroll.min.js"></script>
<script src="/users/js/main.js"></script>
<script>
    function test(category) {
        $.ajax({
            type: "POST",
            url: "/shop_category",
            data: { category: category },
            success: function (response) {
             

                var productList = $('#product-list');
                productList.empty();

                (response.categoryProduct[0]?.products || []).forEach((product) => {
                    const productItem = `   <div class="col-lg-4 col-md-6">
              <li class="product-item">
                <div class="product-card" tabindex="0">
                  <figure class="card-banner">
                    <a href="/product/${product._id}">
                      <img src="/images/products_image/${product.product_image[0]}" width="312" height="350" loading="lazy" alt="${product.product_name}" class="image-contain">
                    </a>
                    ${product.product_badge ? `<div class="card-badge">${product.product_badge}</div>` : ''}
                    <ul class="card-action-list">
                      <li class="card-action-item">
                        <button <% if (locals.userActive) { %>
                                                    onclick="cartCount('${product._id}')"
                                                        <% }else{ %>
                                                            onclick="goToLoginPage()"
                                                            <% } %>  class="card-action-btn" aria-labelledby="card-label-1">
                          <ion-icon name="cart-outline"></ion-icon>
                        </button>
                        <div class="card-action-tooltip" id="card-label-1">Add to Cart</div>
                      </li>
                      <li class="card-action-item">
                        <button class="card-action-btn" <% if (locals.userActive) { %>
                            onclick="addToWishlist('${product._id}')"
                                                        <% }else{ %>
                                                            onclick="goToLoginPage()"
                                                            <% } %>   aria-labelledby="card-label-2">
                          <ion-icon name="heart-outline"></ion-icon>
                        </button>
                        <div class="card-action-tooltip" id="card-label-2">Add to Whishlist</div>
                      </li>
                     
                    </ul>
                  </figure>
                  <div class="card-content">
                    <div class="card-cat">
                      ${(product.product_categoryName || []).map(i => `<a href="/${i.category}" class="card-cat-link">${i.category}</a>`).join(' / ')}
                    </div>
                    <h3 class="h3 card-title">
                      <a href="/product/${product._id}">
                        ${product.product_name}
                      </a>
                    </h3>
                    <data class="card-price" value="${product.product_price}">₹${product.product_price}
                        `
                    if (product.product_old_price) {
                        `
                        <del>${product.product_old_price}</del></data>
                        `
                    }
                    `
                            
                  </div>
                </div>
              </li>
            </div>
          `;
                    productList.append(productItem);


                });

                let productPage = ` <div class="col-lg-12 text-center mt-5">
                                <div class="pagination__option">
                                    <a class="page-link" href="/shop">1</a>`
                for (let i = 2; i <= response.totalPages; i++) {
                    `<a class="page-link" href="/shop?page=${i} %>">
                                            ${i}
                                        </a>`
                }
                `
                                            <!--   <a href="#"><i class="fa fa-angle-right"></i></a> -->
                                </div>
                            </div>
                            `
                productList.append(productPage);

            },
            error: function (xhr, status, error) {
                console.error(error);
            }
        });
    }

    /*
        function updateProductList() {
            // Clear the current list of products
            $('#product-list').empty();
    
            // Add the updated list of products to the page
              const productHTML = `
              <# (productData || [] ).forEach(product=> { %>
              `;
              $('#product-list').append(productHTML);
           
          }
     */


</script>

<script>
    function cartCount(id,stock) {
     
        $.ajax({
            type: 'post',
            url: '/add-toCart/' + id,
            data: ({ stock: stock }),
            success: (cartCounts) => {
                if (cartCounts) {
                    document.getElementById('cartCount').innerHTML = cartCounts
                }

                const toastLiveExample = document.getElementById('toasterMessage')

                document.getElementById('toastMessage').innerHTML = "Product has been added to your cart."
                const toast = new bootstrap.Toast(toastLiveExample, {
                    autohide: true,
                    delay: 3000
                })
                toast.show()

            }
        })
    }
</script>


<script>
    function addToWishlist(id) {
 
        $.ajax({
            type: 'get',
            url: '/add-toWishlist/' + id,
            success: (wishlistCount) => {
                if (wishlistCount) {
                    document.getElementById('wishlistCount').innerHTML = wishlistCount
                }
                const toastLiveExample = document.getElementById('toasterMessage')

                document.getElementById('toastMessage').innerHTML = "Product has been added to your wishlist."
                const toast = new bootstrap.Toast(toastLiveExample, {
                    autohide: true,
                    delay: 3000
                })
                toast.show()


            }
        })
    }
</script>

<script>
    $('#price-range').slider({
        rand: true,
        min: 100,
        max: 50000,
        values: [100, 50000],

        slide: function (event, ui) {
            $('#minamount').val(ui.values[0])
            $('#maxamount').val(ui.values[1])

            /* $.ajax({
                type: 'post',
                url: 'price_filter',
                data: {
                    minPrice: ui.values[0],
                    maxPrice: ui.values[1]
                }, success: (response) => {
    
                }
            }) */
        },
        stop: function (event, ui) {

            const checkboxes = document.querySelectorAll('.category-checkbox');
            let brandName = []
            // Loop through each checkbox and check if it is checked or not
            checkboxes.forEach((checkbox) => {
                if (checkbox.checked) {
                    // If the checkbox is checked, get its value (which is the category name)
                    brandName.push(checkbox.value);
                    // Output the category name to the console
                }
            });
         
            $.ajax({
                type: 'post',
                url: '/price_filter',
                data: {
                    minPrice: ui.values[0],
                    maxPrice: ui.values[1],
                },
                success: function (response) {
                    var productList = $('#product-list');
                    productList.empty();
                    (response || []).forEach((product) => {
                        const productItem = `   <div class="col-lg-4 col-md-6">
              <li class="product-item">
                <div class="product-card" tabindex="0">
                  <figure class="card-banner">
                    <a href="/product/${product._id}">
                      <img src="/images/products_image/${product.product_image[0]}" width="312" height="350" loading="lazy" alt="${product.product_name}" class="image-contain">
                    </a>
                    ${product.product_badge ? `<div class="card-badge">${product.product_badge}</div>` : ''}
                    <ul class="card-action-list">
                      <li class="card-action-item">
                        <button <% if (locals.userActive) { %>
                            onclick="cartCount('${product._id}')"
                                            <% }else{ %>
                                                onclick="goToLoginPage()"
                                                <% } %>  class="card-action-btn" aria-labelledby="card-label-1">
                          <ion-icon name="cart-outline"></ion-icon>
                        </button>
                        <div class="card-action-tooltip" id="card-label-1">Add to Cart</div>
                      </li>
                      <li class="card-action-item">
                        <button class="card-action-btn" <% if (locals.userActive) { %>
                            onclick="addToWishlist('${product._id}')"
                                            <% }else{ %>
                                                onclick="goToLoginPage()"
                                                <% } %>  aria-labelledby="card-label-2">
                          <ion-icon name="heart-outline"></ion-icon>
                        </button>
                        <div class="card-action-tooltip" id="card-label-2">Add to Whishlist</div>
                      </li>
                     
                    </ul>
                  </figure>
                  <div class="card-content">
                    <div class="card-cat">
                      ${(product.product_categoryName || []).map(i => `<a href="/${i.category}" class="card-cat-link">${i.category}</a>`).join(' / ')}
                    </div>
                    <h3 class="h3 card-title">
                      <a href="/product/${product._id}">
                        ${product.product_name}
                      </a>
                    </h3>
                    ${product.product_stock > 0 ? `<data class="card-price" value="${product.product_price}">₹${product.product_price}` : `<span class="text-danger">Out Of Stock</span>`}
                    
                   
                      
                        ${product.product_old_price ? `<del>${product.product_old_price}</del></data>` : ``}
                      
                            
                  </div>
                </div>
              </li>
            </div>
          `;
                        productList.append(productItem);


                    });

                    let productPage = ` <div class="col-lg-12 text-center mt-5">
                                <div class="pagination__option">
                                    <a class="page-link" href="/shop">1</a>`
                    for (let i = 2; i <= response.totalPages; i++) {
                        `<a class="page-link" href="/shop?page=${i} %>">
                                            ${i}
                                        </a>`
                    }
                    `
                                            <!--   <a href="#"><i class="fa fa-angle-right"></i></a> -->
                                </div>
                            </div>
                            `
                    productList.append(productPage);
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    // handle error
                }
            });
        }

    })
</script>

